{"version":3,"sources":["ng://primeng/keyfilter/keyfilter.ts"],"names":["KEYFILTER_VALIDATOR","provide","NG_VALIDATORS","useExisting","forwardRef","KeyFilter","multi","DEFAULT_MASKS","pint","int","pnum","money","num","hex","email","alpha","alphanum","KEYS","SAFARI_KEYS","63234","63235","63232","63233","63276","63277","63272","63273","63275","el","this","ngModelChange","EventEmitter","isAndroid","DomHandler","Object","defineProperty","prototype","_pattern","regex","isNavKeyPress","e","k","keyCode","getBrowser","safari","isSpecialKey","charCode","opera","shiftKey","getKey","getCharCode","which","findDelta","value","prevValue","delta","i","length","substr","isValidChar","c","test","isValidString","str","onInput","pValidateOnly","val","nativeElement","lastVal","lastValue","inserted","removed","emit","onKeyPress","browser","ctrlKey","altKey","mozilla","cc","String","fromCharCode","preventDefault","onPaste","clipboardData","window","getData","pastedText","validate","validatePattern","ElementRef","__decorate","Input","Output","HostListener","Directive","selector","providers","KeyFilterModule","NgModule","imports","CommonModule","exports","declarations"],"mappings":"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","sourcesContent":["import { NgModule, Directive, ElementRef, HostListener, Input, forwardRef, Output, EventEmitter } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { DomHandler } from 'primeng/dom';\nimport { Validator, AbstractControl, NG_VALIDATORS } from '@angular/forms';\n\nexport const KEYFILTER_VALIDATOR: any = {\n    provide: NG_VALIDATORS,\n    useExisting: forwardRef(() => KeyFilter),\n    multi: true\n};\n\nconst DEFAULT_MASKS = {\n    pint: /[\\d]/,\n    'int': /[\\d\\-]/,\n    pnum: /[\\d\\.]/,\n    money: /[\\d\\.\\s,]/,\n    num: /[\\d\\-\\.]/,\n    hex: /[0-9a-f]/i,\n    email: /[a-z0-9_\\.\\-@]/i,\n    alpha: /[a-z_]/i,\n    alphanum: /[a-z0-9_]/i\n};\n\nconst KEYS = {\n    TAB: 9,\n    RETURN: 13,\n    ESC: 27,\n    BACKSPACE: 8,\n    DELETE: 46\n};\n\nconst SAFARI_KEYS = {\n    63234: 37, // left\n    63235: 39, // right\n    63232: 38, // up\n    63233: 40, // down\n    63276: 33, // page up\n    63277: 34, // page down\n    63272: 46, // delete\n    63273: 36, // home\n    63275: 35  // end\n};\n\n@Directive({\n    selector: '[pKeyFilter]',\n    providers: [KEYFILTER_VALIDATOR]\n})\nexport class KeyFilter implements Validator {\n\n    @Input() pValidateOnly: boolean;\n\n    @Output() ngModelChange: EventEmitter<any> = new EventEmitter();\n\n    regex: RegExp;\n\n    _pattern: any;\n\n    isAndroid: boolean;\n\n    lastValue: any;\n\n    constructor(public el: ElementRef) { \n        this.isAndroid = DomHandler.isAndroid();\n    }\n\n    get pattern(): any {\n        return this._pattern;\n    }\n\n    @Input('pKeyFilter') set pattern(_pattern: any) {\n        this._pattern = _pattern;\n        this.regex = DEFAULT_MASKS[this._pattern] || this._pattern;\n    }\n\n    isNavKeyPress(e: KeyboardEvent) {\n        let k = e.keyCode;\n        k = DomHandler.getBrowser().safari ? (SAFARI_KEYS[k] || k) : k;\n\n        return (k >= 33 && k <= 40) || k == KEYS.RETURN || k == KEYS.TAB || k == KEYS.ESC;\n    };\n\n    isSpecialKey(e: KeyboardEvent) {\n        let k = e.keyCode;\n        let c = e.charCode;\n\n        return k == 9 || k == 13 || k == 27 || k == 16 || k == 17 ||(k >= 18 && k <= 20) ||\n            (DomHandler.getBrowser().opera && !e.shiftKey && (k == 8 || (k >= 33 && k <= 35) || (k >= 36 && k <= 39) || (k >= 44 && k <= 45)));\n    }\n\n\n    getKey(e: KeyboardEvent) {\n        let k = e.keyCode || e.charCode;\n        return DomHandler.getBrowser().safari ? (SAFARI_KEYS[k] || k) : k;\n    }\n\n    getCharCode(e: KeyboardEvent) {\n        return e.charCode || e.keyCode || e.which;\n    }\n\n    findDelta(value: string, prevValue: string) { \n        let delta = '';\n\n        for (let i = 0; i < value.length; i++) {\n            let str = value.substr(0, i) + value.substr(i + value.length - prevValue.length);\n\n            if (str === prevValue) \n                delta = value.substr(i, value.length - prevValue.length);\n        }\n\n        return delta;\n    }\n\n    isValidChar(c: string) {\n        return this.regex.test(c);\n    }\n\n    isValidString(str: string) {\n        for (let i = 0; i < str.length; i++) {\n            if (!this.isValidChar(str.substr(i, 1))) {\n                return false;\n            }\n        }\n\n        return true;\n    }\n\n    @HostListener('input', ['$event'])\n    onInput(e: KeyboardEvent) { \n        if (this.isAndroid && !this.pValidateOnly) {\n            let val = this.el.nativeElement.value;\n            let lastVal = this.lastValue || '';\n\n            let inserted = this.findDelta(val, lastVal);\n            let removed = this.findDelta(lastVal, val);\n            let pasted = inserted.length > 1 || (!inserted && !removed);\n\n            if (pasted) {\n                if (!this.isValidString(val)) {\n                    this.el.nativeElement.value = lastVal;\n                    this.ngModelChange.emit(lastVal);\n                }\n            } \n            else if (!removed) {\n                if (!this.isValidChar(inserted)) {\n                    this.el.nativeElement.value = lastVal;\n                    this.ngModelChange.emit(lastVal);\n                }\n            }\n\n            val = this.el.nativeElement.value;\n            if (this.isValidString(val)) {\n                this.lastValue = val;\n            }\n        }\n    }\n\n    @HostListener('keypress', ['$event'])\n    onKeyPress(e: KeyboardEvent) {\n        if (this.isAndroid || this.pValidateOnly) {\n            return;\n        }\n        \n        let browser = DomHandler.getBrowser();\n\n        if (e.ctrlKey || e.altKey) {\n            return;\n        }\n\n        let k = this.getKey(e);\n        \n        if (k == 13) {\n            return;\n        }\n\n        if (browser.mozilla && (this.isNavKeyPress(e) || k == KEYS.BACKSPACE || (k == KEYS.DELETE && e.charCode == 0))) {\n            return;\n        }\n\n        let c = this.getCharCode(e);\n        let cc = String.fromCharCode(c);\n        let ok = true;\n\n        if (browser.mozilla && (this.isSpecialKey(e) || !cc)) {\n            return;\n        }\n\n        ok = this.regex.test(cc);\n\n        if (!ok) {\n            e.preventDefault();\n        }\n    }\n\n    @HostListener('paste', ['$event'])\n    onPaste(e) {\n        const clipboardData = e.clipboardData || (<any>window).clipboardData.getData('text');\n        if (clipboardData) {\n            const pastedText = clipboardData.getData('text');\n            if (!this.regex.test(pastedText)) {\n                e.preventDefault();\n            }\n        }\n    }\n\n    validate(c: AbstractControl): { [key: string]: any } {\n        if(this.pValidateOnly) {\n            let value = this.el.nativeElement.value;\n            if (value && !this.regex.test(value)) {\n                return {\n                    validatePattern: false\n                }\n            }\n        }\n    }\n    \n}\n\n@NgModule({\n    imports: [CommonModule],\n    exports: [KeyFilter],\n    declarations: [KeyFilter]\n})\nexport class KeyFilterModule { }"]}